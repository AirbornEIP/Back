const fetch = require('node-fetch');
// eslint-disable-next-line import/extensions
const UpdateVac = require('../models/UpdateVac.Model');
// eslint-disable-next-line import/extensions
const vacPlan = require('../models/VacPlan.Model');

const aerodrome = ['LFOI', 'LFBA', 'LFDA', 'LFMA', 'LFKJ', 'LFAQ', 'LFKA', 'LFCI', 'LFOF', 'LFMS', 'LFXA', 'LFHT', 'LFEF', 'LFAY', 'LFFI', 'LFCD', 'LFJR', 'LFBU', 'LFLP', 'LFLI', 'LFCH', 'LFAJ', 'LFEG', 'LFQD', 'LFNJ', 'LFHO', 'LFJF', 'LFEH', 'LFDH', 'LFLW', 'LFQF', 'LFLA', 'LFGE', 'LFMV', 'LFNT', 'LFRW', 'LFCB', 'LFAO', 'LFFL', 'LFSB', 'LFEU', 'LFFR', 'LFMR', 'LFKB', 'LFGF', 'LFOB', 'LFFO', 'LFNX', 'LFGG', 'LFEA', 'LFHN', 'LFHW', 'LFKY', 'LFIB', 'LFAM', 'LFBE', 'LFPD', 'LFNR', 'LFQM', 'LFSA', 'LFPF', 'LFMU', 'LFBZ', 'LFBS', 'LFOQ', 'LFCS', 'LFBD', 'LFDY', 'LFHS', 'LFLD', 'LFRB', 'LFEI', 'LFFN', 'LFHR', 'LFSL', 'LFFB', 'LFRK', 'LFCC', 'LFAC', 'LFKC', 'LFYG', 'LFMD', 'LFMK', 'LFNH', 'LFIG', 'LFDQ', 'LFMW', 'LFCX', 'LFCK', 'LFJH', 'LFIH', 'LFLH', 'LFQK', 'LFOK', 'LFLB', 'LFLE', 'LFJY', 'LFGX', 'LFQV', 'LFOR', 'LFMX', 'LFFH', 'LFTQ', 'LFOC', 'LFFU', 'LFLX', 'LFEJ', 'LFCA', 'LFQH', 'LFJA', 'LFDW', 'LFPX', 'LFPH', 'LFRC', 'LFOU', 'LFJC', 'LFLC', 'LFBG', 'LFGA', 'LFAD', 'LFID', 'LFJD', 'LFKT', 'LFGH', 'LFDV', 'LFPK', 'LFLJ', 'LFTF', 'LFBY', 'LFRG', 'LFAB', 'LFQZ', 'LFGI', 'LFSD', 'LFEB', 'LFRD', 'LFGJ', 'LFGR', 'LFON', 'LFAK', 'LFDE', 'LFFE', 'LFSW', 'LFSE', 'LFSG', 'LFQE', 'LFOX', 'LFFY', 'LFAE', 'LFAS', 'LFMF', 'LFLZ', 'LFKF', 'LFCF', 'LFOG', 'LFNO', 'LFFK', 'LFPQ', 'LFDX', 'LFDG', 'LFNA', 'LFKG', 'LFRF', 'LFCQ', 'LFEV', 'LFLS', 'LFLG', 'LFCE', 'LFES', 'LFSH', 'LFTH', 'LFEY', 'LFHA', 'LFEK', 'LFMI', 'LFIX', 'LFGK', 'LFFJ', 'LFCJ', 'LFQX', 'LFOL', 'LFHU', 'LFRE', 'LFFQ', 'LFFG', 'LFAL', 'LFTN', 'LFNQ', 'LFTZ', 'LFDR', 'LFRI', 'LFBH', 'LFKP', 'LFRJ', 'LFHL', 'LFSU', 'LFRO', 'LFRL', 'LFAF', 'LFHX', 'LFJV', 'LFOV', 'LFEL', 'LFMQ', 'LFOH', 'LFOY', 'LFMC', 'LFRM', 'LFNZ', 'LFPP', 'LFHP', 'LFAT', 'LFQL', 'LFXU', 'LFOO', 'LFDU', 'LFOM', 'LFMZ', 'LFDI', 'LFQQ', 'LFQO', 'LFBL', 'LFPL', 'LFGS', 'LFGL', 'LFRH', 'LFDL', 'LFQC', 'LFJU', 'LFKL', 'LFLY', 'LFHJ', 'LFLL', 'LFLM', 'LFFC', 'LFJI', 'LFTB', 'LFDM', 'LFML', 'LFQJ', 'LFJB', 'LFPE', 'LFHM', 'LFPM', 'LFNB', 'LFKX', 'LFQT', 'LFJL', 'LFCM', 'LFCZ', 'LFNC', 'LFMG', 'LFFW', 'LFEM', 'LFDB', 'LFSM', 'LFGM', 'LFAR', 'LFLQ', 'LFDC', 'LFLT', 'LFBK', 'LFNG', 'LFMT', 'LFHI', 'LFPU', 'LFRU', 'LFAX', 'LFHY', 'LFGB', 'LFBR', 'LFEX', 'LFSN', 'LFEZ', 'LFAI', 'LFRS', 'LFNN', 'LFFT', 'LFQG', 'LFMN', 'LFME', 'LFTW', 'LFBN', 'LFCN', 'LFGZ', 'LFCO', 'LFOJ', 'LFOZ', 'LFEC', 'LFLK', 'LFDJ', 'LFGN', 'LFPG', 'LFPB', 'LFPO', 'LFBP', 'LFBX', 'LFAG', 'LFHC', 'LFMP', 'LFPA', 'LFIP', 'LFQP', 'LFHD', 'LFFP', 'LFRP', 'LFBI', 'LFCP', 'LFSV', 'LFGO', 'LFSP', 'LFED', 'LFPT', 'LFEP', 'LFKO', 'LFTP', 'LFNW', 'LFEQ', 'LFRQ', 'LFER', 'LFQA', 'LFRN', 'LFAP', 'LFIR', 'LFIK', 'LFIL', 'LFLO', 'LFDN', 'LFCR', 'LFHE', 'LFYR', 'LFOP', 'LFCY', 'LFHF', 'LFIF', 'LFFD', 'LFRT', 'LFHG', 'LFPZ', 'LFGY', 'LFMH', 'LFGP', 'LFHQ', 'LFKM', 'LFIM', 'LFCG', 'LFIS', 'LFIY', 'LFKH', 'LFKE', 'LFBJ', 'LFNL', 'LFRZ', 'LFQN', 'LFDP', 'LFOW', 'LFLR', 'LFKR', 'LFSS', 'LFOS', 'LFLN', 'LFDF', 'LFYS', 'LFXB', 'LFMY', 'LFNE', 'LFDS', 'LFQU', 'LFGT', 'LFGU', 'LFEW', 'LFOD', 'LFQY', 'LFSJ', 'LFGQ', 'LFTM', 'LFFZ', 'LFNS', 'LFJS', 'LFKD', 'LFDK', 'LFST', 'LFGC', 'LFDT', 'LFBT', 'LFCT', 'LFET', 'LFBO', 'LFIT', 'LFBF', 'LFCL', 'LFFX', 'LFJT', 'LFEN', 'LFOT', 'LFPN', 'LFQB', 'LFCU', 'LFNU', 'LFLU', 'LFAV', 'LFNV', 'LFRV', 'LFAU', 'LFIV', 'LFGW', 'LFQW', 'LFLV', 'LFHH', 'LFFV', 'LFCV', 'LFHV', 'LFCW', 'LFAW', 'LFNF', 'LFQS', 'LFSK', 'LFYV'];
const aerodromeBis = ['ABBEVILLE', 'AGEN LA GARENNE', "AIRE SUR L'ADOUR", 'AIX LES MILLES', 'AJACCIO NAPOLEON BONAPARTE', 'ALBERT BRAY', 'ALBERTVILLE Général Pierre Delachenal', 'ALBI LE SEQUESTRE', 'ALENCON VALFRAMBERT', 'ALES CEVENNES', 'AMBERIEU', 'AMBERT LE POYET', 'AMBOISE DIERRE', 'AMIENS-GLISY', 'ANCENIS', 'ANDERNOS LES BAINS', 'ANGERS MARCE', 'ANGOULEME BRIE CHAMPNIERS', 'ANNECY MEYTHET', 'ANNEMASSE', 'ARCACHON LA TESTE DE BUCH', 'ARGENTAN', 'ARGENTON SUR CREUSE', 'ARRAS ROCLINCOURT', 'ASPRES SUR BUECH', 'AUBENAS ARDECHE MERIDIONALE', 'AUBENASSON', 'AUBIGNY SUR NERE', 'AUCH GERS', 'AURILLAC', 'AUTUN BELLEVUE', 'AUXERRE BRANCHES', 'AVALLON', 'AVIGNON CAUMONT', 'AVIGNON PUJAUT', 'AVRANCHES LE VAL SAINT PERE', 'BAGNERES DE LUCHON', "BAGNOLES DE L'ORNE COUTERNE", 'BAILLEAU ARMENONVILLE', 'BALE-MULHOUSE', 'BAR LE DUC LES HAUTS DE CHEE', 'BAR SUR SEINE', 'BARCELONNETTE SAINT PONS', 'BASTIA PORETTA', 'BEAUNE CHALLANGES', 'BEAUVAIS TILLE', 'BEAUVOIR FROMENTINE', 'BEDARIEUX LA TOUR SUR ORB', 'BELFORT CHAUX', 'BELLE ILE', 'BELLEGARDE VOUVRAY', 'BELLEVILLE VILLIE MORGON', 'BELLEY-PEYRIEU', 'BELVES SAINT PARDOUX', 'BERCK SUR MER', 'BERGERAC DORDOGNE PERIGORD', 'BERNAY SAINT MARTIN', 'BERRE LA FARE', 'BESANCON LA VEZE', 'BESANCON THISE', 'BEYNES THIVERVAL', 'BEZIERS VIAS', 'BIARRITZ PAYS BASQUE', 'BISCARROSSE PARENTIS', 'BLOIS LE BREUIL', 'BORDEAUX LEOGNAN SAUCATS', 'BORDEAUX MERIGNAC', 'BORDEAUX YVRAC', 'BOURG CEYZERIAT', 'BOURGES', 'BREST BRETAGNE', 'BRIARE CHATILLON', 'BRIENNE LE CHATEAU', 'BRIOUDE BEAUMONT', 'BRIVE SOUILLAC', 'BUNO BONNEVAUX', 'CAEN CARPIQUET', 'CAHORS LALBENQUE', 'CALAIS MARCK', 'CALVI SAINTE CATHERINE', 'CAMBRAI NIERGNIES', 'CANNES MANDELIEU', 'CARCASSONNE SALVAZA', 'CARPENTRAS', 'CASSAGNES BEGONHES', 'CASTELNAU MAGNOAC', 'CASTELNAUDARY VILLENEUVE', 'CASTELSARRASIN MOISSAC', 'CASTRES MAZAMET', 'CAZERES PALAMINY', 'CHALAIS', 'CHALON CHAMPFORGEUIL', 'CHALONS ECURY SUR COOLE', 'CHALONS VATRY', 'CHAMBERY AIX LES BAINS', 'CHAMBERY CHALLES LES EAUX', 'CHAMBLEY', 'CHAMPAGNOLE CROTENAY', 'CHARLEVILLE MEZIERES', 'CHARTRES METROPOLE', 'CHATEAU ARNOUX SAINT AUBAN', 'CHATEAU THIERRY BELLEAU', 'CHATEAUBRIANT POUANCE', 'CHATEAUDUN', 'CHATEAUNEUF SUR CHER', 'CHATEAUROUX DEOLS', 'CHATEAUROUX VILLERS', 'CHATELLERAULT TARGE', 'CHATILLON SUR SEINE', 'CHAUMONT SEMOUTIERS', 'CHAUVIGNY', 'CHAVENAY VILLEPREUX', 'CHELLES LE PIN', 'CHERBOURG MANCHE', 'CHOLET LE PONTREAU', 'CLAMECY', 'CLERMONT FERRAND AUVERGNE', 'COGNAC CHATEAUBERNARD', 'COLMAR HOUSSEN', 'COMPIEGNE MARGNY', 'CONDOM VALENCE SUR BAISE', 'CORLIER', 'CORTE', 'COSNE SUR LOIRE', 'COUHE VERAC', 'COULOMMIERS VOISINS', 'COURCHEVEL', 'CUERS PIERREFEU', 'DAX SEYRESSE', 'DEAUVILLE NORMANDIE', 'DIEPPE SAINT AUBIN', 'DIEUZE GUEBLANGE', 'DIJON DAROIS', 'DIJON LONGVIC', 'DINAN TRELIVAN', 'DINARD PLEURTUIT SAINT MALO', 'DOLE TAVAUX', 'DONCOURT LES CONFLANS', 'DREUX VERNOUILLET', 'DUNKERQUE LES MOERES', 'EGLETONS', 'ENGHIEN MOISSELLES', 'EPERNAY PLIVOT', 'EPINAL DOGNEVILLE', 'EPINAL MIRECOURT', 'ETAIN ROUVRES', 'ETAMPES MONDESIR', 'ETREPAGNY', 'EU MERS LE TREPORT', "FALAISE MONTS D'ERAINES", 'FAYENCE', 'FEURS CHAMBEON', 'FIGARI SUD CORSE', 'FIGEAC LIVERNON', 'FLERS SAINT PAUL', 'FLORAC SAINTE ENIMIE', 'FONTENAY LE COMTE', 'FONTENAY TRESIGNY', 'FUMEL MONTAYRAL', 'GAILLAC LISLE SUR TARN', 'GAP TALLARD', 'GHISONACCIA ALZITONE', 'GRANVILLE MONT SAINT MICHEL', 'GRAULHET MONTDRAGON', 'GRAY SAINT ADRIEN', 'GRENOBLE ALPES ISERE', 'GRENOBLE LE VERSOUD', 'GUERET SAINT LAURENT', 'GUISCRIFF SCAER', 'HAGUENAU', 'HYERES LE PALYVESTRE', "ILE D'YEU", 'ISSOIRE LE BROC', 'ISSOUDUN LE FAY', 'ISTRES LE TUBE', 'ITXASSOU', 'JOIGNY', 'JOINVILLE MUSSEY', 'JONZAC NEULLES', 'JUVANCOURT', "L'AIGLE SAINT MICHEL", "L'ALPE D'HUEZ", 'LA BAULE ESCOUBLAC', 'LA FERTE ALAIS', 'LA FERTE GAUCHER', 'LA FLECHE THOREE LES PINS', "LA GRAND'COMBE", 'LA LLAGONNE LA QUILLANE', 'LA MOLE', 'LA REOLE FLOUDES', 'LA ROCHE SUR YON LES AJONCS', 'LA ROCHELLE ILE DE RE', 'LA TOUR DU PIN CESSIEU', 'LANDIVISIAU', 'LANGOGNE LESPERON', 'LANGRES ROLAMPONT', 'LANNION', 'LANVEOC POULMIC', 'LAON CHAMBRY', 'LAPALISSE PERIGNY', 'LASCLAVERIES', 'LAVAL ENTRAMMES', 'LE BLANC', 'LE CASTELLET', 'LE HAVRE OCTEVILLE', 'LE HAVRE SAINT ROMAIN', 'LE LUC LE CANNET', 'LE MANS ARNAGE', 'LE MAZET DE ROMANIN', 'LE PLESSIS BELLEVILLE', 'LE PUY LOUDES', "LE TOUQUET COTE D'OPALE", 'LENS BENIFONTAINE', 'LES MUREAUX', "LES SABLES D'OLONNE TALMONT", 'LESPARRE SAINT LAURENT MEDOC', 'LESSAY', 'LEZIGNAN CORBIERES', 'LIBOURNE ARTIGUES DE LUSSAC', 'LILLE LESQUIN', 'LILLE MARCQ EN BAROEUL', 'LIMOGES BELLEGARDE', 'LOGNES EMERAINVILLE', 'LONGUYON VILLETTE', 'LONS LE SAUNIER COURLAOUX', 'LORIENT LANN BIHOUE', 'LOUDUN', 'LUNEVILLE CROISMARE', 'LURCY LEVIS', 'LYON BRINDAS', 'LYON BRON', 'LYON CORBAS', 'LYON SAINT EXUPERY', 'MACON CHARNAY', 'MANTES CHERENCE', 'MARENNES', 'MARIGNANE BERRE', 'MARMANDE VIRAZEIL', 'MARSEILLE PROVENCE', 'MAUBEUGE ELESMES', 'MAULEON', 'MEAUX ESBLY', 'MEGEVE', 'MELUN VILLAROCHE', 'MENDE BRENOUX', 'MERIBEL ROBERT MERLOZ', 'MERVILLE CALONNE', 'METZ NANCY LORRAINE', 'MILLAU LARZAC', 'MIMIZAN', 'MONT DAUPHIN SAINT CREPIN', 'MONTAGNE NOIRE', 'MONTAIGU SAINT GEORGES', 'MONTARGIS VIMORY', 'MONTAUBAN', 'MONTBELIARD COURCELLES', 'MONTCEAU LES MINES POUILLOUX', 'MONTDIDIER', 'MONTELIMAR ANCONE', 'MONTENDRE MARCILLAC', 'MONTLUCON DOMERAT', 'MONTLUCON GUERET', 'MONTPELLIER CANDILLARGUES', 'MONTPELLIER MEDITERRANEE', 'MORESTEL', 'MORET EPISY', 'MORLAIX PLOUJEAN', 'MORTAGNE AU PERCHE', 'MOULINS MONTBEUGNY', 'MULHOUSE HABSHEIM', 'MURET LHERM', 'NANCY AZELOT', 'NANCY ESSEY', 'NANCY MALZEVILLE', 'NANGIS LES LOGES', 'NANTES ATLANTIQUE', 'NARBONNE', 'NEUFCHATEAU', 'NEVERS FOURCHAMBAULT', "NICE COTE D'AZUR", 'NIMES COURBESSAC', 'NIMES GARONS', 'NIORT MARAIS POITEVIN', 'NOGARO', 'NUITS SAINT GEORGES', 'OLORON HERRERE', 'ORLEANS BRICY', "ORLEANS SAINT DENIS DE L'HOTEL", 'OUESSANT', 'OYONNAX ARBENT', 'PAMIERS LES PUJOLS', 'PARAY LE MONIAL', 'PARIS CHARLES DE GAULLE', 'PARIS LE BOURGET', 'PARIS ORLY', 'PAU PYRENEES', 'PERIGUEUX BASSILLAC', 'PERONNE SAINT QUENTIN', 'PEROUGES MEXIMIEUX', 'PERPIGNAN RIVESALTES', 'PERSAN BEAUMONT', 'PEYRESOURDE BALESTAS', 'PHALSBOURG BOURSCHEID', 'PIERRELATTE', 'PITHIVIERS', 'PLOERMEL LOYAT', 'POITIERS BIARD', 'PONS AVY', 'PONT SAINT VINCENT', 'PONT SUR YONNE', 'PONTARLIER', 'PONTIVY', 'PONTOISE CORMEILLES EN VEXIN', 'POUILLY MACONGE', 'PROPRIANO', 'PUIMOISSON', 'PUIVERT', 'QUIBERON', 'QUIMPER PLUGUFFAN', 'REDON BAINS SUR OUST', 'REIMS PRUNAY', 'RENNES SAINT JACQUES', 'RETHEL PERTHES', 'REVEL MONTGEY', 'RIBERAC TOURETTE', 'RION DES LANDES', 'ROANNE', 'ROCHEFORT CHARENTE-MARITIME', 'RODEZ AVEYRON', 'ROMANS SAINT PAUL', 'ROMORANTIN PRUNIERS', 'ROUEN VALLEE DE SEINE', 'ROYAN MEDIS', 'RUOMS', 'SAINT AFFRIQUE BELMONT', "SAINT ANDRE DE L'EURE", 'SAINT BRIEUC ARMOR', "SAINT CHAMOND L'HORME", "SAINT CYR L'ECOLE", 'SAINT DIE REMOMEIX', 'SAINT ETIENNE LOIRE', 'SAINT FLORENTIN CHEU', 'SAINT FLOUR COLTINES', 'SAINT GALMIER', 'SAINT GAUDENS MONTREJEAU', 'SAINT GIRONS ANTICHAN', 'SAINT INGLEVERT LES DEUX CAPS', "SAINT JEAN D'ANGELY SAINT DENIS DU PIN", "SAINT JEAN D'AVELANNE", 'SAINT JEAN EN ROYANS', 'SAINT JUNIEN', 'SAINT MARTIN DE LONDRES', 'SAINT NAZAIRE MONTOIR', 'SAINT OMER WIZERNES', "SAINT PIERRE D'OLERON", 'SAINT QUENTIN ROUPY', "SAINT RAMBERT D'ALBON", 'SAINT REMY DE MAURIENNE', 'SAINT SULPICE DES LANDES', 'SAINT VALERY VITTEFLEUR', 'SAINT YAN', 'SAINTE FOY LA GRANDE', 'SAINTE LEOCADIE', 'SAINTES THENAC', 'SALON DE PROVENCE', 'SALON EYGUIERES', 'SARLAT DOMME', 'SARRE UNION', 'SARREBOURG BUHL', 'SARREGUEMINES NEUNKIRCH', 'SAULIEU LIERNAIS', 'SAUMUR SAINT FLORENT', 'SAVERNE STEINBOURG', 'SEDAN DOUZY', 'SEMUR EN AUXOIS', 'SERRES LA BATIE MONTSALEON', 'SEZANNE SAINT REMY', 'SISTERON VAUMEILH', 'SOISSONS COURMELLES', 'SOLLIERES SARDIERES', 'SOULAC SUR MER', 'STRASBOURG ENTZHEIM', 'STRASBOURG NEUHOF', 'TARBES LALOUBERE', 'TARBES LOURDES PYRENEES', 'THOUARS', 'TIL CHATEL', 'TOULOUSE BLAGNAC', 'TOULOUSE BOURG SAINT BERNARD', 'TOULOUSE FRANCAZAL', 'TOULOUSE LASBORDES', 'TOURNUS CUISERY', 'TOURS LE LOUROUX', 'TOURS SORIGNY', 'TOURS VAL DE LOIRE', 'TOUSSUS LE NOBLE', 'TROYES BARBEREY', 'USSEL THALAMY', 'UZES', 'VALENCE CHABEUIL', 'VALENCIENNES DENAIN', 'VALREAS VISAN', 'VANNES MEUCON', 'VAUVILLE', 'VENDAYS MONTALIVET', 'VERDUN SOMMEDIEUE', 'VESOUL FROTEY', 'VICHY CHARMEIL', 'VIENNE REVENTIN', 'VIERZON MEREAU', 'VILLEFRANCHE DE ROUERGUE', 'VILLEFRANCHE TARARE', 'VILLENEUVE SUR LOT', 'VILLERUPT', 'VINON', 'VITRY EN ARTOIS', 'VITRY LE FRANCOIS VAUCLERC', 'YVETOT BAONS LE COMTE'];
const date = '08 SEP 2022';
let nextUpdate = '';

// eslint-disable-next-line func-names
exports.script = async function () {
    let dateSave = await UpdateVac.find();
    if (dateSave.length === 0) {
        dateSave = await UpdateVac.create({
            currentDate: date.replace(/ /g, '_'),
        });
        await dateSave.save();
    } else {
        nextUpdate = dateSave.nextUpdate;
    }
    // eslint-disable-next-line no-use-before-define
    await getVacMap();
};

async function getVacMap() {
    try {
        const vacDate = await UpdateVac.find();
        const link = `https://www.sia.aviation-civile.gouv.fr/dvd/eAIP_${vacDate[0].currentDate}/Atlas-VAC/FR/header.htm`;
        let page = await fetch(link);
        page = await page.text();
        page = page.split('\n');

        nextUpdate = page[16].split('<span class=\'headerDate\'>');
        nextUpdate[1] = nextUpdate[1].split('<');
        await UpdateVac.findOneAndUpdate({ nextUpdate: nextUpdate[1][0].replace(/ /g, '_') });
        await vacPlan.remove();
        await Promise.all(aerodrome.map(async (data, index) => {
            const plan = await vacPlan.create({
                link: `https://www.sia.aviation-civile.gouv.fr/dvd/eAIP_${vacDate[0].currentDate}/Atlas-VAC/PDF_AIPparSSection/VAC/AD/AD-2.${data}.pdf`,
                name: data,
                fullName: aerodromeBis[index],
            });
            await plan.save();
        }));

        console.log('Vac plan saved');
    } catch (e) {
        const data = await UpdateVac.find();
        UpdateVac.findOneAndUpdate({}, { currentDate: data.nextUpdate });
        console.log('ERROOOOOR');
        return console.log(e);
    }
}

// getVacMap();
